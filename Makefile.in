src = $(wildcard src/*.c)
obj = $(src:.c=.o)
dep = $(src:.c=.d)
bin = spnavcfg

warn = -pedantic -Wall

CC ?= gcc
CFLAGS = $(warn) $(dbg) $(opt) -fcommon $(add_cflags) -MMD
LDFLAGS = -no-pie -lGL -lglut -lspnav -limago -lm $(add_ldflags)

$(bin): $(obj) src/data.o
	$(CC) -o $@ $^ $(LDFLAGS)

-include $(dep)

src/data.o: src/data.s icons/devices.png

.PHONY: clean
clean:
	rm -f $(obj) $(bin) src/data.o

.PHONY: cleandep
cleandep:
	rm -f $(dep)

.PHONY: install
install:
	mkdir -p $(DESTDIR)$(PREFIX)/bin
	cp $(bin) $(DESTDIR)$(PREFIX)/bin/$(bin)
	for i in 48 128 256; do \
		destdir=$(DESTDIR)$(PREFIX)/share/icons/hicolor/$${i}x$${i}/apps; \
		mkdir -p $$destdir; \
		cp icons/spnavcfg-$${i}x$${i}.png $$destdir/spnavcfg.png; \
	done
	mkdir -p $(DESTDIR)$(PREFIX)/share/applications
	cp -a icons/spnavcfg.desktop $(DESTDIR)$(PREFIX)/share/applications/


.PHONY: uninstall
uninstall:
	rm -f $(DESTDIR)$(PREFIX)/bin/$(bin)
	for i in 48 128 256; do \
		destdir=$(DESTDIR)$(PREFIX)/share/icons/hicolor/$${i}x$${i}/apps; \
		rm -f $${destdir}/spnavcfg.png; \
	done
	rm -f $(DESTDIR)$(PREFIX)/share/applications/spnavcfg.desktop
